{% extends "base.html" %}

{% block title %}
My Buzz!
{% endblock %}


{% block content %}
{% if buzz_auth %}
    <h1>My Buzz</h1>
    <h2>Latest Tweets</h2>
    <div id="mybuzz_timeline">
        <div id="loader">
            <img src="{{ MEDIA_URL }}images/loader.gif">
        </div>
    </div>
{% else %}
    <h2>You need to sign in!</h2>
    <p><a href="/login/">Click here to sign here</a></p>
{% endif %}
{% endblock %}

{% block script %}
    {% if buzz_auth %}
    // Get user timeline
    $.getJSON('{% url mybuzz_timeline %}', function(data) {
        $('#loader').fadeOut('fast');
        for(tweet in data) {
            var form_id = 'bookmark_form_' + tweet;
            var bookmark_id = 'bookmark_' + tweet;
            
            // append tweet
            
            $('#mybuzz_timeline').append('<div class="tweet_result"><div class="tweet">' + data[tweet].text +
            '</div>' +
            '<div class="tweet_info">' + 
            '<div class="fleft"><img src="{{ MEDIA_URL }}images/user_ico.gif"></div>' +
            '<div class="fleft padbottom">' + data[tweet].user.screen_name + '</div>' + 
            '<div class="fleft"><a id="' + bookmark_id  + '"><img src="{{ MEDIA_URL }}images/bookmark_ico.gif"></div>' + 
            // form data
            '<form id="' + form_id + '"' + ' method="post">' +
            '<input type="hidden" name="tweet_id" value="' + data[tweet].id + '">' +
            '<input type="hidden" name="tweet_txt" value="' + data[tweet].text + '">' +
            '<input type="hidden" name="tweeter_screenname" value="' + data[tweet].user.screen_name  + '"> +
            '</form>'
            '<div class="clear"></div>'  + 
            '</div></div>').fadeIn('slow');
            
            // add post handler
            $('#' + bookmark_id).click(function(){
                $.post('{% url mybuzz_add_bookmark %}', $("#" + form_id).serialize(), function(data) {
                  alert(data);
                });
            })
        }
    });
    {% endif %}
{% endblock %}